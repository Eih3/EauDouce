{% extends "base/front.html" %}

{% block title %}{{ data['title'] }}{% endblock %}

{% block head %}
    {%- if g.plugins.CodeHighlighting in ("true", "True", True) %}
    <!-- 代码高亮插件 -->
    <link href="{{ url_for('static', filename='highlight/styles/') }}{{ request.args.get('ShowStyle', 'googlecode') }}.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='highlight/highlight.pack.js') }}"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    {% endif -%}

    <style type="text/css">
        fieldset{padding:.35em .625em .75em;margin:0 2px;border:1px solid #009;border-radius:5px;}
        legend{padding:.5em;border:0;width:auto}
        img{max-width: 100%}
    </style>
{% endblock %}

{% block PathNavigation %}
			<ul class="breadcrumb">
				<li>
					<a href="{{ url_for('front.index') }}">首页</a>
				</li>
                <li>
                    <a href="{{ url_for('front.blogResource', resource_type='catalog', resource_data=data.catalog) }}" title="查看 {{ data.catalog }} 分类中所有文章">{{ data.catalog }}</a>
                </li>
				<li class="active">
					{{ data.title }}
				</li>
			</ul>
{% endblock %}

{% block container %}
            <!-- 文章详情 -->
            <article>
                <header>
			        <h3 class="text-center text-success">{{ data['title'] }}
                    {% if data.get("sources") == "原创" %}
                        <attr title="原创文章"><img src="{{ url_for('static', filename='img/Original.gif') }}"></attr>
                    {% elif data.get("sources") == "转载" %}
                        <attr title="转载文章"><img src="{{ url_for('static', filename='img/Reprint.gif') }}"></attr>
                    {% elif data.get("sources") == "翻译" %}
                        <attr title="翻译文章"><img src="{{ url_for('static', filename='img/Translate.gif') }}"></attr>
                    {% endif %}
                    </h3>
			    </header>
                <fieldset>
                    <legend><small class="text-info text-lowercase">功能区</small></legend>
                    {% set admins = g.api.user_get_admins().data %}
                    <div class="btn-group" role="group" aria-label="...">
                        {% if g.signin and g.username == data.author or g.username in admins %}
                            <a href="{{ url_for('front.blogEdit', blogId=blogId) }}" style='color:blue'><button type="button" class="btn btn-warning">编辑文章</button></a>
                            <a href="javascript:delBlog()" style='color:blue'><button type="button" class="btn btn-danger">删除文章</button></a>
                        {% endif %}
                        {% if g.username in admins %}
                            {% if data.top in ('true', 'True', True) %}
                                <a href="javascript:setTop(false)" style='color:blue'><button type="button" class="btn btn-primary">取消置顶</button></a>
                            {% else %}
                                <a href="javascript:setTop(true)" style='color:blue'><button type="button" class="btn btn-primary">置顶文章</button></a>
                            {% endif %}
                            {% if data.recommend in ('true', 'True', True) %}
                                <a href="javascript:setRecommend(false)" style='color:blue'><button type="button" class="btn btn-info">取消推荐</button></a>
                            {% else %}
                                <a href="javascript:setRecommend(true)" style='color:blue'><button type="button" class="btn btn-info">推荐文章</button></a>
                            {% endif %}
                        {% endif %}
                    </div>
                    <h6>
                        {% if data.author %}
                        <i class="icon-user icon-1x"></i><a href="{{ url_for('front.userHome', user=data.author) }}" title="由 {{ data.author }} 发布" style="color: #999">&nbsp;{{ data.author }}</a>&nbsp;
                        {% endif %}

                        {% if data.catalog %}
                        <i class="icon-folder-open icon-1x"></i><a href="{{ url_for('front.blogResource', resource_type='catalog', resource_data=data.catalog) }}" title="查看 {{ data.catalog }} 分类中所有文章" style="color: #999">&nbsp;{{ data.catalog }}</a>&nbsp;
                        {% endif %}

                        {% if data.tag %}
                        <i class="icon-tag icon-1x"></i>
                        {% for tag in data.tag.split() %}
                            <a href="{{ url_for('front.blogResource', resource_type='tag', resource_data=tag) }}" title="查看 {{ tag }} 标签中所有文章" style="color: #999">{{ tag }}</a>&nbsp;
                        {% endfor %}
                        {% endif %}

                        {% if data.create_time %}
                        <i class="icon-calendar icon-1x"></i><scan style="color: #999">&nbsp;{{ data.create_time }}</scan>&nbsp;
                        {% endif %}

                        {%- if g.plugins.ChangyanComment.enable in ('true', 'True', True) %}
                        <i class="icon-comment-alt icon-1x"></i>&nbsp;评论<a href="#SOHUCS">{{ g.api.misc_get_commend(blogId).data.comments }}</a>次&nbsp;
                        {% endif %}

                        {% if BaiduActivePushResult %}
                            <scan class="text-success"><i class="icon-ok-circle icon-1x"></i>&nbsp;百度主动推送成功</scan>
                        {% else %}
                            <scan class="text-danger"><i class="icon-ok-circle icon-1x"></i>&nbsp;百度主动推送失败</scan>
                        {% endif %}

                        {% if g.plugins.BaiduIncludedCheck in ("true", "True", True) %}
                            <scan id="BaiduIncludedCheck"></scan>
                        {% endif %}
                    </h6>
                </fieldset>
                <fieldset>
                    <legend><small class="text-success text-lowercase">正文区</small></legend>
				    {{ data['content'] | safe }}
                </fieldset>
                {%- if data.get("sources") == "原创" %}
                <p></p>
                <div class="alert alert-success alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <b>版权声明</b>：<br />
                    &nbsp;&nbsp;&nbsp;&nbsp;本文为原创文章，由 {{ g.api.get_sys_config().data.about_awi }} 创作和发表，版权所有，转载请注明作者及出处！<br />
                    &nbsp;&nbsp;&nbsp;&nbsp;本文标题是：{{ data['title'] }}， 本文来源地址：<a href="{{ request.url }}" class="alert-link">{{ request.url }}</a>
                </div>
                {% endif -%}
            </article>

            {%- if g.plugins.Reward in ('true', 'True', True) or g.plugins.Like in ('true', 'True', True) %}
                <!--点赞、打赏-->
                <div class="thumbs_content">
                    {% if g.plugins.Like in ('true', 'True', True) %}
                    <a href="javascript:void(0)" class="thumbs_button fa fa-thumbs-up" title="点赞, 支持一下"> 点赞</a>
                    {% endif %}
                    {%- if g.plugins.Reward in ('true', 'True', True) %}
                    <a href="javascript:void(0)" class="reward_button fa fa-money" title="打赏, 支持一下" onclick="PaymentUtils.show();"> 打赏</a>
                    {% endif %}
                    <p class="thumbs_reward_clear"></p>
                </div>
            {% endif -%}

            {%- if g.plugins.BaiduShare in ('true', 'True', True) %}
                <!-- 百度分享插件 -->
                <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more">分享给朋友</a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友">QQ好友</a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a><a href="#" class="bds_huaban" data-cmd="huaban" title="分享到花瓣">花瓣</a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook">Facebook</a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter">Twitter</a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记">有道云笔记</a><a href="#" class="bds_mail" data-cmd="mail" title="分享到邮件分享">邮件分享</a></div>
                <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
            {% endif -%}

            {%- if g.plugins.ChangyanComment.enable in ('true', 'True', True) %}
                <!-- 畅言评论框插件,PC和WAP自适应版 -->
                <div id="SOHUCS" sid="{{ blogId }}" ></div> 
                <script type="text/javascript"> 
                (function(){ 
                    var appid = '{{ g.plugins.ChangyanComment.appid }}'; 
                    var conf = '{{ g.plugins.ChangyanComment.appkey }}'; 
                    var width = window.innerWidth || document.documentElement.clientWidth; 
                    if (width < 960) { 
                        window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); 
                </script>
            {% endif -%}
{% endblock %}

{% block script %}

<script type="text/javascript">
{%- if g.plugins.Reward in ('true', 'True', True) %}
/*!
 * 仿百度打赏的博客打赏组件
 * Date: 2016-09-10 11:00
 * http://zhangge.net/5110.html
 * (c) 2013-2016 张戈博客保留所有权利.
 *
 * 给博客添加模仿百度打赏的打赏组件
 * 张戈博客基于百度打赏的原创功能，引用或转载请保留版权申明，谢谢合作！
 */
(function($){
    var id = Date.now();
    if($("#STYLE_"+id).length<1){
        document.writeln("<style id='STYLE_"+id+"'>@CHARSET \"UTF-8\";*{-webkit-tap-highlight-color:rgba(255,0,0,0)}.box-size{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}.ds-hide{display:none}.ds-reward-stl{font-family:\"microsoft yahei\";text-align:center;background:#f1f1f1;padding:10px 0;color:#666;margin:20px auto;width:90%}#dsRewardBtn {padding: 0;margin: 0;position: absolute;background: #7ab951;left: 110px;top: -7px;width: 50px;height: 50px;font-size: 16px;font-weight: 600;line-height: 43px;display: block;border: 4px solid #fff;border-radius: 40px;color: #FFF;}#dsRewardBtn span{display:inline-block;width:50px;height:50px;border-radius:100%;line-height:58px;color:#fff;font:400 25px/50px 'microsoft yahei';background:#FEC22C}#dsRewardBtn:hover{cursor:pointer}.ds-dialog{z-index:9999;width:100%;height:100%;position:fixed;top:0;left:0;border:1px solid #d9d9d9}.ds-dialog .ds-close-dialog{position:absolute;top:15px;right:20px;font:400 24px/24px Arial;width:20px;height:20px;text-align:center;padding:0;cursor:pointer;background:transparent;border:0;-webkit-appearance:none;font-weight:700;line-height:20px;opacity:.6;filter:alpha(opacity=20)}.ds-dialog .ds-close-dialog:hover{color:#000;text-decoration:none;cursor:pointer;opacity:.6;filter:alpha(opacity=40)}.ds-dialog-bg{position:absolute;opacity:.6;filter:alpha(opacity=30);background:#000;z-index:9999;left:0;top:0;width:100%;height:100%}.ds-dialog-content{font-family:'microsoft yahei';font-size:14px;background-color:#FFF;position:fixed;padding:0 20px;z-index:10000;overflow:hidden;border-radius:6px;-webkit-box-shadow:0 3px 7px rgba(0,0,0,.3);-moz-box-shadow:0 3px 7px rgba(0,0,0,.3);box-shadow:0 3px 7px rgba(0,0,0,.3);-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.ds-dialog-pc{width:390px;height:380px;top:50%;left:50%;margin:-190px 0 0 -195px}.ds-dialog-wx{width:90%;height:280px;top:50%;margin-top:-140px;margin-left:5%}.ds-dialog-content h5{text-align:left;font-size:15px;font-weight:700;margin:15px 0;color:#555}.ds-payment-way{text-align:left}.ds-payment-way label{cursor:pointer;font-weight:400;display:inline-block;font-size:14px;margin:0 15px 0 0;padding:0}.ds-payment-way input[type=radio]{vertical-align:middle;margin:-2px 5px 0 0}.ds-payment-img{margin:15px 0;text-align:center}p.ds-pay-info{font-size:15px;margin:0 0 10px}.ds-pay-money{font-size:14px;margin-top:10px}.ds-pay-money p{margin:0}.ds-pay-money .ds-pay-money-sum{margin-bottom:4px}.ds-payment-img img{margin:0 auto;width:185px;}.ds-payment-img #qrCode_1{display:none}.ds-payment-img .qrcode-border{margin:0 auto}.ds-payment-img .qrcode-tip{width:48.13px;position:relative;margin:0 auto;font-size:12px;font-weight:700;background:#fff;height:15px;line-height:15px;margin-top:-12px}#qrCode_0 .qrcode-tip{color:#3caf36}#qrCode_3 .qrcode-tip{color:#e10602}.ds-payment-img #qrCode_3{display:none}.ds-payment-img #qrCode_2{display:none}#qrCode_2 .qrcode-tip{color:#eb5f01}#qrCode_1 .qrcode-tip{color:#6699cc}.wx_qrcode_container{text-align:center}.wx_qrcode_container h2{font-size:17px}.wx_qrcode_container p{font-size:14px}.ds-reward-stl{text-align:left;background:#fff;padding:0;color:#666;margin:0;width:0}#dsRewardBtn span{position:absolute;left:115px;top:-7px;background:#7ab951;width:50px;height:50px;font-size:16px;font-weight:600;line-height:43px;border:4px solid #fff;border-radius:40px}.share-s a{margin-top:-25px} .ds-payment-img .qrcode-border{border-radius: 29.97px; width: 236.89px; height: 236.89px; padding: 18.05px; margin-top: 25.53px; } </style>");
    }
    function write(){
        var content = "<div class=\"ds-dialog\" id='PAY_"+id+"'>"
        +"   <div class=\"ds-dialog-bg\" onclick=\"PaymentUtils.hide();\"></div>"
        +"   <div class=\"ds-dialog-content ds-dialog-pc \">"
        +"    <i class=\"ds-close-dialog\">&times;</i>"
        +"    <h5>选择打赏方式：</h5>"
        +"    <div class=\"ds-payment-way\">"
        +"     <label for=\"wechat\"><input type=\"radio\" id=\"wechat\" class=\"reward-radio\" value=\"0\" checked=\"checked\" name=\"reward-way\" />微信红包</label>"
        +"     <label for=\"alipay\"><input type=\"radio\" id=\"alipay\" class=\"reward-radio\" value=\"2\" name=\"reward-way\" />支付宝</label>"
        + "    </div>"
        + "    <div class=\"ds-payment-img\">"
        + "     <div class=\"qrcode-img qrCode_0\" id=\"qrCode_0\">"
        + "      <div class=\"qrcode-border box-size\" style=\"border: 9.02px solid rgb(60, 175, 54\">"
        + "       <img  class=\"qrcode-img qrCode_0\" id=\"qrCode_0\" src=\"/static/img/wxpay.jpg\" />"
        + "      </div>"
        + "      <p class=\"qrcode-tip\">打赏</p>"
        + "     </div>"
        + "     <div class=\"qrcode-img qrCode_2\" id=\"qrCode_2\">"
        + "      <div class=\"qrcode-border box-size\" style=\"border: 9.02px solid rgb(235, 95, 1\">"
        + "       <img  class=\"qrcode-img qrCode_2\" id=\"qrCode_2\" src=\"/static/img/alipay.jpg\" />"
        + "      </div>"
        + "      <p class=\"qrcode-tip\">打赏</p>"
        + "     </div>"
        + "    </div>"
        + "   </div>"
        + "  </div> ";
        $("body").append(content);
    }
$(function(){
    write();
    var $pay = $("#PAY_"+id).hide();
    $pay.find(".ds-payment-way").bind("click",function(){
                $pay.find(".qrcode-img").hide();
        $pay.find(".qrCode_"+$pay.find("input[name=reward-way]:checked").val()).show();
      });
     $pay.find(".ds-close-dialog").bind("click",function(){
          $pay.hide();
     });
  });
  var PaymentUtils = window['PaymentUtils']={};
  PaymentUtils.show=function(){
      $("#PAY_"+id).show();
  }
  PaymentUtils.hide=function(){
      $("#PAY_"+id).hide();
  }
})(jQuery);
{% endif -%}

{% if g.plugins.BaiduIncludedCheck in ("true", "True", True) %}
$(document).ready(function () {
    var BaiduIncludedCheck = document.getElementById("BaiduIncludedCheck");
    $.ajax({
        url: "https://api.isecret.vip/api?type=baidu&url={{ request.url }}",
        method: 'GET',
        datatype: 'json',
        success: function(res) {
            console.log(res);
            if (res.Included==1) {
                BaiduIncludedCheck.setAttribute("class", "text-success");
                BaiduIncludedCheck.innerHTML = '<i class="icon-ok-circle icon-1x"></i>&nbsp;百度收录成功';
            } else {
                BaiduIncludedCheck.setAttribute("class", "text-danger");
                BaiduIncludedCheck.innerHTML = '<i class="icon-ok-circle icon-1x"></i>&nbsp;百度收录失败';
            }
        },
        error: function(error){
                BaiduIncludedCheck.setAttribute("class", "text-danger");
                BaiduIncludedCheck.innerHTML = '<i class="icon-ok-circle icon-1x"></i>&nbsp;百度收录插件发生未知错误';
        }
    });
});
{% endif %}

{% if g.username in g.api.user_get_admins().data %}
// 设置或取消置顶文章
function setTop(value) {
    $.ajax({
        url: "{{ url_for('api.misc') }}?action=top&blogId={{ blogId }}&value=" + value,
        method: 'POST',
        datatype: 'json',
        success: function(res) {
            console.log(res);
            if (res.success==true) {
                if(value==false) {
                    layer.msg("取消置顶成功！");
                } else {
                    layer.msg("置顶文章成功！");
                }
            } else {
                if(value==false) {
                    layer.msg("取消置顶失败！"+res.msg, {icon: 2, time: 15*1000});
                } else {
                    layer.msg("置顶文章失败！"+res.msg, {icon: 2, time: 15*1000});
                }
            }
            document.location.reload()
        },
        error: function(error){
            console.log(error);
        }
    });
}

// 设置或取消推荐文章
function setRecommend(value) {
    $.ajax({
        url: "{{ url_for('api.misc') }}?action=recommend&blogId={{ blogId }}&value=" + value,
        method: 'POST',
        datatype: 'json',
        success: function(res) {
            console.log(res);
            if (res.success==true) {
                if(value==false) {
                    layer.msg("取消推荐成功！");
                } else {
                    layer.msg("推荐文章成功！");
                }
            } else {
                if(value==false) {
                    layer.msg("取消推荐失败！"+res.msg, {icon: 2, time: 15*1000});
                } else {
                    layer.msg("推荐文章失败！"+res.msg, {icon: 2, time: 15*1000});
                }
            }
            document.location.reload()
        },
        error: function(error){
            console.log(error);
        }
    });
}

// 删除文章
function delBlog() {
    layer.confirm('你确定要删除此文章?', {
        btn: ['确认删除','我再想想']
    }, function(){
        console.warn("将要删除节点"+{{ blogId }});
        $.ajax({
            url: "{{ url_for('api.blog', blogId=blogId) }}",
            method: 'DELETE',
            async: false,
            datatype: 'json',
            success: function(res) {
                console.log(res);
                if (res.success==true) {
                    layer.msg("删除文章成功！", {icon: 1, time: 3*1000});
                    window.location.href="{{ url_for('front.index') }}";
                } else {
                    layer.msg("删除文章失败！"+res.msg, {icon: 2, time: 15*1000});
                }
            },
            error: function(error){
                console.log(error);
                layer.alert(res.statusText);
            }
        });
    }, function() {
        console.log("canel delete blog");
    });
}
{% endif %}

{% if g.plugins.BaiduAutoPush in ("true", "True", True) %}
// 百度自动推送插件
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
{% endif %}

</script>
{% endblock %}
