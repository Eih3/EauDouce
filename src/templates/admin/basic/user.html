{% extends "base/admin.html" %}

{% block title %}用户管理{% endblock %}

{% block head %}
    <!-- Data Tables -->
    <link href="/static/admin/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
{% endblock %}

{% block content %}
        {% set data = g.api.user_get_all().data %}
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>用户管理</h5><small><a href="{{ url_for('front.blogWrite') }}" target="_blank">&nbsp;创建</a></small>
                    </div>
                    <div class="ibox-content">
                        <table class="table table-striped table-bordered table-hover dataTables-example">
                            <thead>
                                <tr>
                                    <th>用户名</th>
                                    <th>头像</th>
                                    <th>别名</th>
                                    <th>性别</th>
                                    <th>邮箱</th>
                                    <th>格言</th>
                                    <th>加入时间</th>
                                    <th>是否作者</th>
                                    <th>是否管理员</th>
                                    <th>动作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in data %}
                                <tr valign="middle" align="center">
                                    <td>{{ user.username }}</td>
                                    <td><img src="{{ user.avatar }}" width="60px"></td>
                                    <td>{{ user.cname }}</td>
                                    <td>{{ user.gender }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.motto }}</td>
                                    <td>{{ user.time }}</td>
                                    <td>{% if user.isAuthor in ('true', 'True', True) %}是{% else %}否{% endif %}</td>
                                    <td>{% if user.isAdmin in ('true', 'True', True) %}是{% else %}否{% endif %}</td>
                                    <td>
                                        <a class="btn btn-success btn-rounded" href="javascript:ShowProfile('{{ user.username }}')">详细信息</a><br>
                                        {% if user.isAuthor in ('true', 'True', True) %}<a class="btn btn-info btn-rounded" href="buttons.html#">取消作者</a>{% else %}<a class="btn btn-info btn-rounded" href="buttons.html#">设置作者</a>{% endif %}<br>
                                        {% if user.isAdmin in ('true', 'True', True) %}<a class="btn btn-danger btn-rounded" href="buttons.html#">取消管理</a>{% else %}<a class="btn btn-danger btn-rounded" href="buttons.html#">设置管理</a>{% endif %}<br>
                                        <a class="btn btn-danger btn-rounded" href="buttons.html#">删除用户</a><br>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% block script %}
    <!-- Data Tables -->
    <script src="/static/admin/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/static/admin/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <!-- Page-Level Scripts -->
    <script>
        $(document).ready(function () {
            $('.dataTables-example').dataTable();

            /* Init DataTables */
            var oTable = $('#editable').dataTable();
        });

        // iframe层显示个人资料
        function ShowProfile(user) {
            layer.open({
                type: 2,
                title: '查看个人详细资料',
                shadeClose: true,
                shade: 0.8,
                area: ['600px', '600px'],
                content: '{{ url_for("admin.profile") }}?user='+user
            });
        }
    </script>

{% endblock %}